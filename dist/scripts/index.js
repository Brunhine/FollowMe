!function(t){var e={};function o(l){if(e[l])return e[l].exports;var s=e[l]={i:l,l:!1,exports:{}};return t[l].call(s.exports,s,s.exports,o),s.l=!0,s.exports}o.m=t,o.c=e,o.d=function(t,e,l){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:l})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var l=Object.create(null);if(o.r(l),Object.defineProperty(l,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)o.d(l,s,function(e){return t[e]}.bind(null,s));return l},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="modules/followme/scripts/",o(o.s="./src/scripts/followme.js")}({"./src/scripts/followhud.js":
/*!**********************************!*\
  !*** ./src/scripts/followhud.js ***!
  \**********************************/
/*! exports provided: FollowHud */function(t,e,o){"use strict";o.r(e),o.d(e,"FollowHud",(function(){return i}));var l=o(/*! ./followmanager.js */"./src/scripts/followmanager.js"),s=o(/*! ./settings.js */"./src/scripts/settings.js"),n=o(/*! ./utils.js */"./src/scripts/utils.js");class i{static renderFollowHud(t,e,o){let s=canvas.tokens.controlled.find(t=>t.id==o._id);if(1==canvas.tokens.controlled.length&&l.FollowManager.isLeader(s.id))this.addStopFollowButton(e,s.id,!0);else if(2==canvas.tokens.controlled.length){let t=canvas.tokens.controlled.find(t=>t.id!=s.id);l.FollowManager.isFollowing(t.id,s.id)&&!l.FollowManager.isFollowing(s.id,t.id)?this.addStopFollowButton(e,s.id):l.FollowManager.isLeader(s.id)||l.FollowManager.areFollowingEachother(s.id,t.id)||this.addStartFollowButton(e,t.id,s.id)}}static addStartFollowButton(t,e,o){let s=Object(n.findTokenById)(o),i=Object(n.findTokenById)(e),r=this.getButton(t,`Have ${i.name} start following ${s.name}`);r.find("i").click(async t=>{l.FollowManager.startFollowing(e,o),this.addSlash(r)})}static addStopFollowButton(t,e){let o=Object(n.findTokenById)(e),s=Object(n.findTokenById)(l.FollowManager.getFollowerId(e)),i=this.addSlash(this.getButton(t,`Stop ${s.name} from following ${o.name}`));i.find("i").click(async t=>{l.FollowManager.stopFollowing(e),this.removeSlash(i)})}static getButton(t,e){let o=$(`<div class="control-icon followme" title="${e}"><i class="fas ${s.Settings.getIcon()}"></i></div>`);return"top"==s.Settings.getHudTopBottom()?t.find(s.Settings.getHudColumn()).prepend(o):t.find(s.Settings.getHudColumn()).append(o),o}static addSlash(t){let e=$('<i class="fas fa-slash" style="position: absolute; color: tomato"></i>');return t.addClass("fa-stack"),t.find("i").addClass("fa-stack-1x"),e.addClass("fa-stack-1x"),t.append(e),t}static removeSlash(t){return t.find("i")[1].remove(),t}}},"./src/scripts/followmanager.js":
/*!**************************************!*\
  !*** ./src/scripts/followmanager.js ***!
  \**************************************/
/*! exports provided: FollowManager */function(t,e,o){"use strict";o.r(e),o.d(e,"FollowManager",(function(){return n}));var l=o(/*! ./socketinfo.js */"./src/scripts/socketinfo.js"),s=o(/*! ./utils.js */"./src/scripts/utils.js");class n{static async summonFollower(t,e,o){if(this.isLeader(t._id)){let e=Object(s.findTokenById)(t._id),o=Object(s.findTokenById)(this.getFollowerId(e.id)),n=(canvas.scene.data.grid,e.x),i=e.y;game.user.isGM?await o.update({x:n,y:i}):game.socket.emit(l.socketName,{mode:l.socketAction.MoveToken,tokenId:o.id,x:n,y:i})}}static async startFollowing(t,e){if(game.user.isGM){let o=Object(s.findTokenById)(e),l=Object(s.findTokenById)(t);await o.setFlag(s.flagScope,s.flag.follower,t),await l.setFlag(s.flagScope,s.flag.leader,e)}else game.socket.emit(l.socketName,{mode:l.socketAction.StartFollow,followerId:t,leaderId:e})}static async stopFollowing(t){if(game.user.isGM){let e=Object(s.findTokenById)(t),o=Object(s.findTokenById)(e.getFlag(s.flagScope,s.flag.follower));await e.unsetFlag(s.flagScope,s.flag.follower),await o.unsetFlag(s.flagScope,s.flag.leader)}else game.socket.emit(l.socketName,{mode:l.socketAction.StopFollow,followerId:t})}static getFollowerId(t){let e=Object(s.findTokenById)(t);return e&&e.getFlag(s.flagScope,s.flag.follower)||void 0}static isFollower(t){let e=Object(s.findTokenById)(t);return!!e&&null!=e.getFlag(s.flagScope,s.flag.leader)}static isLeader(t){let e=Object(s.findTokenById)(t);return!!e&&null!=e.getFlag(s.flagScope,s.flag.follower)}static isFollowing(t,e){let o=Object(s.findTokenById)(t);return!!o&&o.getFlag(s.flagScope,s.flag.leader)==e}static areFollowingEachother(t,e){return this.isFollowing(t,e)||this.isFollowing(e,t)}}},"./src/scripts/followme.js":
/*!*********************************!*\
  !*** ./src/scripts/followme.js ***!
  \*********************************/
/*! no exports provided */function(t,e,o){"use strict";o.r(e);var l=o(/*! ./followhud.js */"./src/scripts/followhud.js"),s=o(/*! ./followmanager.js */"./src/scripts/followmanager.js"),n=o(/*! ./settings.js */"./src/scripts/settings.js"),i=o(/*! ./socketinfo.js */"./src/scripts/socketinfo.js"),r=o(/*! ./utils.js */"./src/scripts/utils.js");Hooks.on("ready",()=>{n.Settings.registerSettings(),game.socket.on(i.socketName,t=>{if(game.user.isGM)switch(t.mode){case i.socketAction.StartFollow:s.FollowManager.startFollowing(t.followerId,t.leaderId);break;case i.socketAction.StopFollow:s.FollowManager.stopFollowing(t.followerId);break;case i.socketAction.MoveToken:Object(r.findTokenById)(t.tokenId).update({x:t.x,y:t.y})}})}),Hooks.on("renderTokenHUD",(t,e,o)=>{l.FollowHud.renderFollowHud(t,e,o)}),Hooks.on("preUpdateToken",(t,e,o)=>{(o.x||o.y)&&s.FollowManager.summonFollower(e,o.x,o.y)})},"./src/scripts/settings.js":
/*!*********************************!*\
  !*** ./src/scripts/settings.js ***!
  \*********************************/
/*! exports provided: Settings */function(t,e,o){"use strict";o.r(e),o.d(e,"Settings",(function(){return l}));class l{static getIcon(){return"fa-shoe-prints"}static getHudColumn(){return 0==game.settings.get("followme","column")?".col.left":".col.right"}static getHudTopBottom(){return 0==game.settings.get("followme","topbottom")?"top":"bottom"}static registerSettings(){game.settings.register("followme","column",{name:"HUD Column",scope:"world",config:!0,type:Number,default:0,choices:["Left","Right"]}),game.settings.register("followme","topbottom",{name:"HUD Top/Bottom",scope:"world",config:!0,type:Number,default:0,choices:["Top","Bottom"]})}}},"./src/scripts/socketinfo.js":
/*!***********************************!*\
  !*** ./src/scripts/socketinfo.js ***!
  \***********************************/
/*! exports provided: socketName, socketAction */function(t,e,o){"use strict";o.r(e),o.d(e,"socketName",(function(){return l})),o.d(e,"socketAction",(function(){return s}));const l="module.followme",s={StartFollow:0,StopFollow:1,MoveToken:2}},"./src/scripts/utils.js":
/*!******************************!*\
  !*** ./src/scripts/utils.js ***!
  \******************************/
/*! exports provided: flagScope, socketName, flag, findTokenById */function(t,e,o){"use strict";o.r(e),o.d(e,"flagScope",(function(){return l})),o.d(e,"socketName",(function(){return s})),o.d(e,"flag",(function(){return n})),o.d(e,"findTokenById",(function(){return i}));const l="followme",s="module.followme",n={leader:"leader",follower:"follower"};function i(t){return canvas.tokens.placeables.find(e=>e.id==t)}}});
//# sourceMappingURL=index.js.map